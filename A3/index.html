<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Test Assignment</title>

  </head>
  <body>
    <h1>Straight Shaft Selection</h1>
    <solver-frame>
      Shaft material properties
      <row-1>
        <div>$F_U$ = </div>
        <div><input value = "550" class = "variable" name = "FU"/> MPa</div>
      </row-1>
      <row-1>
        <div>$F_Y$ = </div>
        <div><input value = "550"  class = "variable" name = "FY"/> MPa</div>
      </row-1>
      <row-1>
        <div>$F_R$ = </div>
        <div><input value = "FY*0.45"  class = "variable" name = "FR"/> MPa</div>
      </row-1>
      Factor of Safety
      <row-1>
        <div>$F_S$ = </div>
        <div><input value = "2"  class = "variable" name = "FS"/> </div>
      </row-1>

      <row-1>
        <div>$M_q$ = </div>
        <div><input value = "100"  class = "variable" name = "Mq"/> $\text{N}\cdot\text{m}$</div>
      </row-1>
      <row-1>
        <div>$T_q$ = </div>
        <div><input value = "1000"  class = "variable" name = "Tq"/> $\text{N}\cdot\text{m}$</div>
      </row-1>
      <row-1>
        <div>$P_q$ = </div>
        <div><input value = "100"  class = "variable" name = "Pq"/> $\text{N}$</div>
      </row-1>

      <div>
        An initial trial diameter was selected.
      </div>
      <row-1>
        <div>$D_0$ = </div>
        <div><input value = 25  class = "variable" name = "D0"/> mm</div>
      </row-1>

      <div>
        To calculate the stress raising factor $K_s$ a point was taken on the plot.
      </div>

      <plot-image class = "variable" name = "Ks_D" src = "https://mech3460.w4v.es/Solver/PlotImageData/Ks(D).json">
      </plot-image>

      <output>
        The following equation, from the AS1403-2004 rotating shaft standards $$\hat{D}^3 = \cfrac{10^4F_S}{F_R}K_s K \sqrt{\left( M_q + \cfrac{P_q D}{8000}\right)^2 + \cfrac{3}{4}T_q^2}$$ for a shaft with more than 600 start stops and more than 900 power applied torque reversals per year
        was used to find a better diamter $\hat{D}$ from a guess diameter. Itterations where continued until $\left| \cfrac{\hat{D} - D}{\hat{D}} \right| \le 0.1\%$. Given a trial diameter of $D_0 = ~{D0}\text{mm}$ a final diameter of $$D = ~{D}\text{mm}$$
      </output>
    </solver-frame>
  </body>

  <script type = "module">
    import {} from "../Solver/solver-frame.js"
    let solver = document.querySelector("solver-frame");
    function pow(num, p) {return Math.pow(num, p);}
    function sqrt(num, p) {return Math.sqrt(num, p);}

    function finalSolver(scope) {
      let {D0, Mq, Pq, Tq, FS, FR, K, Ks_D} = scope;
      if (!K) K = 1;

      let D = null;
      let error = 1;
      let ittc = 0;
      while (error > 0.001 && ittc < 10) {

        let t1 = K * Ks_D(D0) * (1e4 * FS) / (FR);
        let t2 = sqrt(pow(Mq + Pq * D0 / 8000, 2) + (3/4) * pow(Tq, 2));
        D = pow(t1 * t2, 1/3);

        error = (D - D0) / D;
        D0 = D;
        ittc++;
      }

      scope.D = D;
    }

    solver.addSolverMethod(finalSolver);
  </script>

  <style>
    body {
      display: flex;
      flex-direction: column;
      font-size: calc(0.9vmax + 0.9vmin);
      margin: 6em;
    }
    row-1 {
      display: flex;
      justify-content: center;
      gap: 0.5em;
      align-items: center;
      min-height: 3em;
    }
    plot-image {
      display: flex;
      justify-content: center;
    }
    plot-image svg {
      width: 100%;
      height: 100%;
    }
    input {
      font: inherit;
    }

  </style>
</html>
